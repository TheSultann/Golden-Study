<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
</head>
<body>
    <div class="main">
        <button class="student-list-button" onclick="location.href='/students'">
            Students
            <i class="fas fa-arrow-right"></i>
        </button>

        <div class="container" id="adminControls" style="display: none;">
            <div class="input-group">
                <input type="text" placeholder="Student's Name" id="userName">
                <button id="addUserBtn">Add Student</button>
            </div>
        </div>

        <div class="statistic-container">
            <a href="/users/index.html" class="statistic-button">üìä Student Statistics</a>
            <div id="statisticsTable"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const role = window.location.pathname.includes('/teacher') ? 'admin' : 'guest';
        localStorage.setItem('userRole', role); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–æ–ª—å –≤ localStorage

        if (role === 'admin') {
            document.getElementById('adminControls').style.display = 'block';
        }

        document.getElementById('addUserBtn').addEventListener('click', () => {
            const userName = document.getElementById('userName').value;
            if (userName) {
                addStudent(userName);
            }
        });

        async function addStudent(name) {
            try {
                const response = await axios.post('/users', { userName: name }, {
                    headers: { 'X-Role': role }
                });

                if (response.status === 201) {
                    alert('–£—á–µ–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                    document.getElementById('userName').value = '';
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–µ–Ω–∏–∫–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞');
            }
        }
    </script>
    
</body>
</html>